name: Sync Screenshots

on:
  schedule:
    - cron: '0 */6 * * *'
  workflow_dispatch:
  push:
    branches:
      - enes/image-generation

jobs:
  sync-screenshots:
    runs-on: ubicloud-standard-8
    steps:
      - name: Checkout documentation repository
        uses: actions/checkout@v4
        with:
          path: documentation

      - name: Get latest screenshot script from ubicloud/ubicloud
        uses: actions/checkout@v4
        with:
          repository: ubicloud/ubicloud
          path: ubicloud

      - name: Set up Ruby
        uses: ruby/setup-ruby@v1
        with:
          ruby-version: .tool-versions
          working-directory: ubicloud
          bundler-cache: true

      - name: Run screenshot script
        working-directory: ubicloud
        run: |
          ls -lah .
          ruby -v
          which ruby
          bundle install
          ruby ./bin/regen-screenshots

      - name: Check diff
        run: git diff --stat

      # - name: Check for changes in OpenAPI specification
      #   id: check-changes
      #   run: |
      #     diff_output=$(diff "$SOURCE_FILE" "$TARGET_FILE" || true)
      #     if [ -n "$diff_output" ]; then
      #       echo "changes=true" >> $GITHUB_OUTPUT
      #     else
      #       echo "changes=false" >> $GITHUB_OUTPUT
      #     fi

      # - name: Update OpenAPI specification if changed
      #   if: steps.check-changes.outputs.changes == 'true'
      #   run: |
      #     cp "$SOURCE_FILE" "$TARGET_FILE"
      #     git config user.name "github-actions[bot]"
      #     git config user.email "github-actions[bot]@users.noreply.github.com"
      #     git add "$TARGET_FILE"
      #     git commit -m "Update OpenAPI specification from ubicloud/ubicloud"
      #     git push
